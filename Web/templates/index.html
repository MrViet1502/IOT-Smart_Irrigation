<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ğŸŒ¿ Smart Irrigation Dashboard</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f2fef4;
      padding: 40px;
      color: #333;
    }

    h1 {
      color: #2e7d32;
      font-size: 28px;
    }

    h3 {
      color: #388e3c;
      margin-top: 30px;
    }

    .sensor-data, .control-panel {
      padding: 20px;
      border: 1px solid #c8e6c9;
      border-radius: 10px;
      background-color: #ffffff;
      margin-bottom: 20px;
      max-width: 400px;
    }

    p {
      font-size: 18px;
      margin: 8px 0;
    }

    #status-msg {
      margin-top: 10px;
      font-weight: bold;
      color: #2e7d32;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px 5px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      color: white;
      background-color: #43a047;
    }

    button:hover {
      background-color: #2e7d32;
    }

    button.off {
      background-color: #e53935;
    }

    button.off:hover {
      background-color: #b71c1c;
    }
  </style>
  <script>
    async function fetchData() {
      try {
        const res = await fetch("/api/data");
        const data = await res.json();
        document.getElementById("temp").innerText = data.temperature.value + " Â°C";
        document.getElementById("humid").innerText = data.humidity.value + " %";
        document.getElementById("gas").innerText = data.mq2_analog.value;
        document.getElementById("timestamp").innerText = data.temperature.timestamp;
      } catch (err) {
        console.error("âŒ KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u:", err);
        document.getElementById("timestamp").innerText = "Máº¥t káº¿t ná»‘i tá»›i Flask...";
      }
    }

    async function sendCommand(state) {
      try {
        const res = await fetch("/api/control", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ command: state ? "on" : "off" })
        });

        const result = await res.json();

        const msg = result.status === "success"
          ? `âœ… ÄÃ£ gá»­i lá»‡nh thÃ nh cÃ´ng! Tráº¡ng thÃ¡i LED: ${result.led ? "Báº¬T " : "Táº®T ğŸ›‘"}`
          : `âŒ Gá»­i lá»‡nh tháº¥t báº¡i: ${result.error || "KhÃ´ng rÃµ lá»—i"}`;

        document.getElementById("status-msg").innerText = msg;
      } catch (err) {
        document.getElementById("status-msg").innerText = "âŒ Lá»—i gá»­i lá»‡nh!";
        console.error("Gá»­i lá»‡nh lá»—i:", err);
      }
}


    window.onload = () => {
      fetchData();
      setInterval(fetchData, 5000);
    };
  </script>
</head>
<body>
  <h1>ğŸŒ¿ Há»‡ thá»‘ng tÆ°á»›i cÃ¢y thÃ´ng minh</h1>

  <div class="sensor-data">
    <h3>ğŸ“ˆ GiÃ¡m sÃ¡t cáº£m biáº¿n:</h3>
    <p>Nhiá»‡t Ä‘á»™: <span id="temp">--</span></p>
    <p>Äá»™ áº©m: <span id="humid">--</span></p>
    <p>KhÃ­ gas (MQ2): <span id="gas">--</span></p>
    <p>â° Cáº­p nháº­t: <span id="timestamp">--</span></p>
  </div>

  <div class="control-panel">
    <h3>ğŸ•¹ï¸ Äiá»u khiá»ƒn led:</h3>
    <button onclick="sendCommand(true)"> Báº­t </button>
    <button class="off" onclick="sendCommand(false)">ğŸ›‘ Táº¯t </button>
    <p id="status-msg"></p>
  </div>
</body>
</html>



<!-- 
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Irrigation System</title>
  <script>
    async function fetchData() {
      try {
        const res = await fetch("/api/data");
        const data = await res.json();
        document.getElementById("temp").innerText = data.temperature.value + " Â°C";
        document.getElementById("humid").innerText = data.humidity.value + " %";
        document.getElementById("gas").innerText = data.mq2_analog.value;
        document.getElementById("timestamp").innerText = data.temperature.timestamp;
      } catch (err) {
        console.error("âŒ KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u:", err);
        document.getElementById("timestamp").innerText = "Máº¥t káº¿t ná»‘i tá»›i Flask...";
      }
    }

    async function sendCommand(command) {
      try {
        const res = await fetch("/api/control", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ command })
        });
        const result = await res.json();
        alert("ğŸ“¡ ÄÃ£ gá»­i lá»‡nh: " + (result.sent || result.error));
      } catch (err) {
        alert("âŒ Lá»—i gá»­i lá»‡nh!");
        console.error("RPC error:", err);
      }
    }

    setInterval(fetchData, 5000);
    window.onload = fetchData;
  </script>
</head>
<body>
  <h1>ğŸŒ¿ Há»‡ thá»‘ng tÆ°á»›i cÃ¢y thÃ´ng minh</h1>
  <h3>GiÃ¡m sÃ¡t cáº£m biáº¿n:</h3>
  <p>Nhiá»‡t Ä‘á»™: <span id="temp">--</span></p>
  <p>Äá»™ áº©m: <span id="humid">--</span></p>
  <p>MQ2: <span id="gas">--</span></p>
  <p>â° Cáº­p nháº­t: <span id="timestamp">--</span></p>

  <h3>ğŸ•¹ï¸ Äiá»u khiá»ƒn mÃ¡y bÆ¡m:</h3>
  <button onclick="sendCommand('on')">ğŸ’§ Báº­t tÆ°á»›i</button>
  <button onclick="sendCommand('off')">ğŸ›‘ Táº¯t tÆ°á»›i</button>
</body>
</html> -->
